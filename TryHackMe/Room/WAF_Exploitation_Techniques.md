# WAF: Exploitation Techniques — TryHackMe - Web Application Red Teaming
**Date:** 2025-12-31  
**Type:** TryHackMe  
**Scope:** Lab / Authorized only

---

## 1) Context
Short summary (1–3 lines): This lab covers practical techniques to bypass Web Application Firewalls (WAFs). The focus is on understanding normalization, encoding, obfuscation, and protocol-level evasion using an outdated OWASP Core Rule Set (CRS v3.3.5).

---

## 2) Initial hypothesis
Expected: Learn to bypass WAF protections using known evasion techniques, including XSS, SQLi, and SSTI. Hypothesized that outdated or misconfigured rules could be exploited.

---

## 3) Tools used
- Browser
- Burp Suite (Repeater, Intruder)
- curl

---

## 4) Approach (high level)
1. Identify endpoints protected by the WAF (comments, login, search, template rendering).  
2. Test standard XSS, SQLi, and SSTI payloads to confirm WAF enforcement.  
3. Analyze CRS behavior and rule IDs to identify blocked patterns.  
4. Apply evasion techniques: encoding, obfuscation, mixed-case payloads, whitespace insertion.  
5. Exploit method and header discrepancies to bypass WAF inspection.  
6. Validate successful payload execution while maintaining non-sensitive evidence.

---

## 5) Results / Evidence (sanitized)
### WAF Bypass Observations
- **Blocked payloads:** Basic `<script>` tags and standard XSS, SQLi, SSTI attempts returned **403 Forbidden**.  
- **Bypass techniques successful:**
  - Unicode + HTML entity encoding
  - Mixed-case keywords and inline comments
  - Obfuscation using `eval()`, `atob()`, and anchor tags
  - HTTP method switching (POST → GET)
  - Header manipulation (`X-Forwarded-For`)
- **Impact:** Successfully stored XSS, bypassed SQLi login, and executed SSTI payloads without triggering the WAF.  
- **Proof:** Final state demonstrated payload execution, e.g., XSS alert triggered, login bypass granted access, and server command output received (`uid=0(root) gid=0(root) ...`).

---

## 6) Recommended remediation
- Keep WAF rule sets up to date (latest OWASP CRS).  
- Normalize input consistently (URL, HTML entities, Unicode, hex).  
- Avoid simplistic or case-sensitive custom rules.  
- Inspect all HTTP methods and relevant headers uniformly.  
- Use allowlists and contextual validation instead of pure blocklists.  
- Apply defense-in-depth: secure coding, parameterized queries, proper authorization, output encoding.

---

## 7) Lessons learned
- WAFs are **not a security boundary**, only a filtering layer.  
- Signature- and regex-based detection is inherently brittle.  
- Obfuscation, encoding, and protocol manipulation exploit parser mismatches.  
- Custom rules can be weaker than defaults if poorly designed.  
- Understanding WAF logic allows systematic, repeatable bypasses rather than blind brute force.  

---

## 8) Links / Resources
- [TryHackMe - Web Application Red Teaming](https://tryhackme.com/room/webapplicationredteam)  
- [OWASP Core Rule Set (CRS) GitHub)](https://github.com/coreruleset/coreruleset)  
- Detailed write-up (public Notion link if available)
